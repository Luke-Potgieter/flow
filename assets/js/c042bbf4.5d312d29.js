"use strict";(self.webpackChunksite=self.webpackChunksite||[]).push([[7666],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return d}});var o=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},a=Object.keys(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=o.createContext({}),p=function(e){var t=o.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=p(e.components);return o.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},m=o.forwardRef((function(e,t){var n=e.components,r=e.mdxType,a=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),m=p(n),d=r,h=m["".concat(s,".").concat(d)]||m[d]||u[d]||a;return n?o.createElement(h,i(i({ref:t},c),{},{components:n})):o.createElement(h,i({ref:t},c))}));function d(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=n.length,i=new Array(a);i[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,i[1]=l;for(var p=2;p<a;p++)i[p]=n[p];return o.createElement.apply(null,i)}return o.createElement.apply(null,n)}m.displayName="MDXCreateElement"},5455:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return l},contentTitle:function(){return s},metadata:function(){return p},toc:function(){return c},default:function(){return m}});var o=n(7462),r=n(3366),a=(n(7294),n(3905)),i=["components"],l={},s="Configure connections with SSH tunneling",p={unversionedId:"guides/connect-network",id:"guides/connect-network",title:"Configure connections with SSH tunneling",description:"Depending on your enterprise network security, you may need to use SHH tunneling, or port forwarding, to allow Flow",source:"@site/docs/guides/connect-network.md",sourceDirName:"guides",slug:"/guides/connect-network",permalink:"/guides/connect-network",editUrl:"https://github.com/estuary/flow/edit/master/site/docs/guides/connect-network.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Create a simple data flow",permalink:"/guides/create-dataflow"},next:{title:"Reduction strategies",permalink:"/reference/reduction-strategies/"}},c=[{value:"Configuration",id:"configuration",children:[],level:3}],u={toc:c};function m(e){var t=e.components,n=(0,r.Z)(e,i);return(0,a.kt)("wrapper",(0,o.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"configure-connections-with-ssh-tunneling"},"Configure connections with SSH tunneling"),(0,a.kt)("p",null,"Depending on your enterprise network security, you may need to use ",(0,a.kt)("a",{parentName:"p",href:"https://www.ssh.com/academy/ssh/tunneling/example#local-forwarding"},"SHH tunneling"),", or port forwarding, to allow Flow\nto securely access your endpoint. This is configured within a capture or materialization definition, but\nbefore you can do this, you'll need a properly configured SSH server on your internal network."),(0,a.kt)("p",null,"These steps provide a basic roadmap, and should be followed with the help of an IT specialist in your organization,\nas details depend on your organization's policies and practices."),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Activate an ",(0,a.kt)("a",{parentName:"p",href:"https://www.ssh.com/academy/ssh/server#availability-of-ssh-servers"},"SSH implementation on a server"),", if you don't have one already.\nConsult the documentation for your server's operating system and/or cloud service provider, as the steps will vary.\nConfigure the server to your organization's standards, or reference the ",(0,a.kt)("a",{parentName:"p",href:"https://www.ssh.com/academy/ssh/sshd_config"},"SSH documentation")," for\nbasic configuration options.")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Referencing the config files and shell output, collect the following information:"),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"The ",(0,a.kt)("strong",{parentName:"li"},"endpoint")," for the SSH server, formatted as ",(0,a.kt)("inlineCode",{parentName:"li"},"ssh://hostname[:port]"),". This may look like the any of following:",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"ssh://ec2-198-21-98-1.compute-1.amazonaws.com")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"ssh://198.21.98.1")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"ssh://198.21.98.1:22")))),(0,a.kt)("li",{parentName:"ul"},"The SSH ",(0,a.kt)("strong",{parentName:"li"},"user"),", which will be used to log into the SSH server, for example, ",(0,a.kt)("inlineCode",{parentName:"li"},"sshuser"),". You may choose to create a new\nuser for this workflow."))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"In the ",(0,a.kt)("inlineCode",{parentName:"p"},".ssh")," subdirectory of your user home directory,\nlook for the PEM file that contains the private SSH key. Check that it starts with ",(0,a.kt)("inlineCode",{parentName:"p"},"-----BEGIN RSA PRIVATE KEY-----"),",\nwhich indicates it is an RSA-based file."),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"If no such file exists, generate one using the command:",(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-console"},"   ssh-keygen -m PEM -t rsa\n"))),(0,a.kt)("li",{parentName:"ul"},"If a PEM file exists, but starts with ",(0,a.kt)("inlineCode",{parentName:"li"},"-----BEGIN OPENSSH PRIVATE KEY-----"),", convert it with the command:",(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-console"},'   ssh-keygen -p -N "" -m pem -f /path/to/key\n')))),(0,a.kt)("p",{parentName:"li"},"Taken together, these configuration details would allow you to log into the SSH server from your local machine.\nThey'll allow the connector to do the same.")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"The PEM files must be encoded with Base64 before they are passed to a connector.\nYou can convert it with the following bash command:"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-console"},"cat <path-to-the-pem-file> | base64 -w 0\n"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Configure your internal network to allow the SSH server to access the endpoint.\nNote the internal ",(0,a.kt)("strong",{parentName:"p"},"host")," and ",(0,a.kt)("strong",{parentName:"p"},"port"),"; these are necessary to open the connection.")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Configure your network to expose the SSH server endpoint to eternal traffic. The method you use\ndepends on your organization's IT policies. Currently, Estuary doesn't provide a list of static IPs for\nwhitelisting purposes, but if you require one, ",(0,a.kt)("a",{parentName:"p",href:"mailto:support@estuary.dev"},"contact Estuary support"),".")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"You can also choose a port on your localhost to use to connect to the SSH server. If you don't have a\nreason to pick a particular point, it is recommended to set this value to ",(0,a.kt)("inlineCode",{parentName:"p"},"0")," in the configuration.\nThis will allow Flow to dynamically pick an open port."))),(0,a.kt)("h3",{id:"configuration"},"Configuration"),(0,a.kt)("p",null,"After you've completed the prerequisites, you should have the following parameters:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"sshEndpoint"),": the endpoint, step 2"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"sshPrivateKeyBase64"),": the encoded PEM file, step 4"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"sshUser"),": the username, step 2"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"remoteHost"),": the endpoint's host, step 5"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"remotePort"),": the endpoint's port, step 5"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"localPort"),": the port on the localhost used to connect to the SSH server, step 7")),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Use these to add SSH tunneling to your capture or materialization definition, either by filling in the corresponding fields\nin a web app, or by working with the YAML directly. Reference the ",(0,a.kt)("a",{parentName:"li",href:"../../concepts/connectors/#connecting-to-endpoints-on-secure-networks"},"Connectors")," page for a code sample.")),(0,a.kt)("p",null,"Proxies like SSH are always run on an open port on your localhost, so you'll need to re-configure other fields in your\ncapture or materialization definition."),(0,a.kt)("ol",{start:2},(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Set the host to ",(0,a.kt)("inlineCode",{parentName:"p"},"localhost"),".")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Set the port to the same value you chose for ",(0,a.kt)("inlineCode",{parentName:"p"},"localPort")," in the SSH configuration."))))}m.isMDXComponent=!0}}]);